<!DOCTYPE html>
<html lang="en">
    <head>
        <title>three.js webgl - buffergeometry - lines drawcalls</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <style>
            body {
                color: #cccccc;
                font-family:Monospace;
                font-size:13px;
                text-align:center;

                background-color: #000000;
                margin: 0px;
                overflow: hidden;
            }

            #info {
                position: absolute;
                top: 0px; width: 100%;
                padding: 5px;
            }

            a {

                color: #0080ff;
            }

        </style>
    </head>
    <body>

        <div id="container"></div>
        <div id="info">
            <a href="http://threejs.org" target="_blank">three.js</a> webgl - buffergeometry drawcalls - by <a href="https://twitter.com/fernandojsg">fernandojsg</a>
        </div>

        <script src="js/libs/dat.gui.min.js"></script>
        <script src="js/three.min.js"></script>
        <script src="js/OrbitControls.js"></script>
        <script src="js/libs/stats.min.js"></script>

        <script>

            var group;
            var container, stats;
            var particlesData = [];
            var camera, scene, renderer, raycaster;
            var positions, colors;
            var pointCloud;
            var particlePositions;
            var linesMesh;
            var mouseX = 0, mouseY = 0;
            var mouseXOnMouseDown = 0;
            var SCREEN_WIDTH, SCREEN_HEIGHT;
            var targetRotation = 0;
            var actuatorCylinder;
            var targetRotationOnMouseDown = 0;
            var windowHalfX = window.innerWidth / 2;
            var windowHalfY = window.innerHeight / 2;
            var pointLight;
            var maxParticleCount = 1000;
            var particleCount = 500;
            var r = 800;
            var rHalf = r / 2;
            document.addEventListener('mousemove', onDocumentMouseMove, false);
            init();
            animate();
            function init() {

                container = document.getElementById('container');
                SCREEN_WIDTH = window.innerWidth;
                SCREEN_HEIGHT = window.innerHeight;
                camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 1000);
//                var centerVector = new THREE.Vector3(150, 0, 0);
                camera.position.x = 20;
                camera.position.z = 120;
                camera.position.y = 50;
                raycaster = new THREE.Raycaster();
                // LIGHTS

                controls = new THREE.OrbitControls(camera, container);
                controls.noZoom = false;
                controls.minDistance = 60;
                controls.maxDistance = 200;
                controls.noPan = true;
                scene = new THREE.Scene();
                var ambientLight = new THREE.AmbientLight(0x222222, 0.2);
//                scene.add(ambientLight);

                var dirLight = new THREE.DirectionalLight(0xffffff, 0.125);
                dirLight.position.set(0, 0, 1).normalize();
//                scene.add(dirLight);

                pointLight = new THREE.PointLight(0xffffff, 1);
                pointLight.position.set(0, 100, 90);
                scene.add(pointLight);
                group = new THREE.Group();
                scene.add(group);
                ///////ADD FILTRU

                var loader = new THREE.JSONLoader(); //initialize the loader util.

                var asd = loader.load('FiltruTigara.json', function (geometry) {

//                    var material = new THREE.MeshLambertMaterial({
//                        map: THREE.ImageUtils.loadTexture('modelPlatforma.json'), // Specify and load the texture
//                        colorAmbient: [0.48, 0.48, 0.48, ],
//                        colorDiffuse: [0.48, 0.48, 0.48],
//                        colorSpecular: [0.899, 0.899, 0.899],
//                    });
                    var material2 = new THREE.MeshFaceMaterial([
                        new THREE.MeshPhongMaterial({color: 0x999999, shading: THREE.SmoothShading}), // front
                        new THREE.MeshPhongMaterial({color: 0xFF0000, shading: THREE.SmoothShading}) // side
                    ]);
                    //create a mesh with models geometry and material
                    filtruTigara = new THREE.Mesh(geometry, material2);
                    filtruTigara.rotation.x = 0;
                    filtruTigara.rotation.y = 0;
                    filtruTigara.scale.x = 1;
                    filtruTigara.scale.y = 1;
                    filtruTigara.scale.z = 1;
                    filtruTigara.position.x = 0;
                    filtruTigara.position.y = 24;
                    filtruTigara.position.z = 0;
                    scene.add(filtruTigara);
                });
                // Add Charger 
                //Grosime,Lungime,Latime
                var chargerGeometry = new THREE.BoxGeometry(15, 50, 10);
                var chargerMaterial = new THREE.MeshPhongMaterial({color: 0x666677, shininess: 10, specular: 0x999999, metal: true, side: 2});
                var chargerCube = new THREE.Mesh(chargerGeometry, chargerMaterial);
                chargerCube.position.x = 15;
                scene.add(chargerCube);
                var disrupterGeometry = new THREE.BoxGeometry(15, 50, 10);
                var disrupterMaterial = new THREE.MeshPhongMaterial({color: 0x88ff00, shininess: 8, specular: 0x999999, metal: true, transparent: true, opacity: 0.5});
                var disrupterCube = new THREE.Mesh(disrupterGeometry, disrupterMaterial);
                scene.add(disrupterCube);
                //Big Action Button

                var actuatorGeometry = new THREE.CylinderGeometry(3, 3, 2, 32);
                var actuatorMaterial = new THREE.MeshPhongMaterial({color: 0x004433});
//                console.log(actuatorMaterial);


                actuatorCylinder = new THREE.Mesh(actuatorGeometry, actuatorMaterial);
                actuatorCylinder.position.x = -7;
                actuatorCylinder.position.y = 18;
                actuatorCylinder.position.z = 0;
                actuatorCylinder.rotation.x = -Math.PI / 2;
                actuatorCylinder.rotation.z = -Math.PI / 2;
                scene.add(actuatorCylinder);
                ////////
                ///Plus Button

                var plusButtonGeometry = new THREE.CylinderGeometry(1, 1, 2, 32);
                var plusButtonMaterial = new THREE.MeshBasicMaterial({color: 0x00ff00});
                var plusButtonCylinder = new THREE.Mesh(plusButtonGeometry, plusButtonMaterial);
                plusButtonCylinder.position.x = -7;
                plusButtonCylinder.position.y = 12;
                plusButtonCylinder.position.z = 0;
                plusButtonCylinder.rotation.x = -Math.PI / 2;
                plusButtonCylinder.rotation.z = -Math.PI / 2;
                scene.add(plusButtonCylinder);
                ////////
                ///Minus Button
                var minusButtonGeometry = new THREE.CylinderGeometry(1, 1, 2, 32);
                var minusButtonMaterial = new THREE.MeshBasicMaterial({color: 0x00ffff});
                var minusButtonCylinder = new THREE.Mesh(minusButtonGeometry, minusButtonMaterial);
                minusButtonCylinder.position.x = -7;
                minusButtonCylinder.position.y = 7;
                minusButtonCylinder.position.z = 0;
                minusButtonCylinder.rotation.x = -Math.PI / 2;
                minusButtonCylinder.rotation.z = -Math.PI / 2;
                scene.add(minusButtonCylinder);
                var displayGeometry = new THREE.PlaneGeometry(8, 20, 32);
                var displayMaterial = new THREE.MeshPhongMaterial({color: 0xff0000, side: THREE.DoubleSide});
                var displayPlane = new THREE.Mesh(displayGeometry, displayMaterial);
                displayPlane.position.x = -7.6;
                displayPlane.position.y = -12;
                displayPlane.position.z = 0;
                displayPlane.rotation.y = -Math.PI / 2;
//                displayPlane.rotation.z = -Math.PI/2;

                scene.add(displayPlane);
                //

                renderer = new THREE.WebGLRenderer({antialias: true});
                renderer.setClearColor(0xffffff, 0.4);
                renderer.setPixelRatio(window.devicePixelRatio);
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.gammaInput = true;
                renderer.gammaOutput = true;
                container.appendChild(renderer.domElement);
                //

                stats = new Stats();
                stats.domElement.style.position = 'absolute';
                stats.domElement.style.top = '0px';
                container.appendChild(stats.domElement);
                renderer.domElement.addEventListener('mousedown', onDocumentMouseDown, false);
                renderer.domElement.addEventListener('touchstart', onDocumentTouchStart, false);
                renderer.domElement.addEventListener('touchmove', onDocumentTouchMove, false);
                window.addEventListener('resize', onWindowResize, false);
            }

            function onWindowResize() {

                windowHalfX = window.innerWidth / 2;
                windowHalfY = window.innerHeight / 2;
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }

            function animate() {


                requestAnimationFrame(animate);
                render();
                stats.update();
            }



            function onDocumentMouseDown(event) {
                event.preventDefault();
                renderer.domElement.addEventListener('mousemove', onDocumentMouseMove, false);
                renderer.domElement.addEventListener('mouseup', onDocumentMouseUp, false);
                renderer.domElement.addEventListener('mouseout', onDocumentMouseOut, false);
//                mouseXOnMouseDown = event.clientX - windowHalfX;
//                targetRotationOnMouseDown = targetRotation;

                var mouseVector = new THREE.Vector3();
                mouseVector.x = 2 * (event.clientX / SCREEN_WIDTH) - 1;
                mouseVector.y = 1 - 2 * (event.clientY / SCREEN_HEIGHT);
//                mouseVector.z = 0.5;

//                console.log(raycaster);
//                console.log(mouseVector);

                raycaster.setFromCamera(mouseVector, camera);
//                console.log(raycaster);


                var intersectedObjects = raycaster.intersectObjects(scene.children);
//                var intersectedTorus = raycaster.intersectObjects(scene.children);

//                console.log(intersectedTorus);
//                console.log(intersectedText);

                if (intersectedObjects.length > 0) {

                    var Object = intersectedObjects[0];

                    switch (Object.object.id) {

                        case 8:
                            console.log("That's the battery mate!");
                            break;
                        case 9:
                            console.log("You clicked the disruptor");
                            break;
                        case 10:
                            console.log("Lighter should START");

                            startButtonClick();


                            break;
                        case 11:
                            console.log("You pressed the +");
                            break;
                        case 12:
                            console.log("You pressed the -");
                            break;
                        case 13:
                            console.log("Why did you click the screen ?");
                            break;
                        case 14:
                            console.log("Why click the Filter ?");
                            break;
                        default:
                            console.log("nothing clicked");
                            break;
                    }

                    var isoDate = new Date(Date.now()).toISOString();
//                    pointLight.color.setHSL(redish, 1, 0.5);

//                    var newmaterial = new THREE.MeshFaceMaterial([
//                        new THREE.MeshPhongMaterial({color: 0xffFFFF, shading: THREE.FlatShading}), // front
//                        new THREE.MeshPhongMaterial({color: 0xff00ff, shading: THREE.SmoothShading}) // side
//                    ]);

//                    console.log(group.children[0]);

//                    group.children[0].material = newmaterial;
//                    var scaleAmount = 0.6;

//                    group.scale.x = scaleAmount;
//                    group.scale.y = scaleAmount;
//                    group.scale.z = scaleAmount;

                }


            }



            function onDocumentMouseMove(event) {

                mouseX = event.clientX - windowHalfX;
                targetRotationX = targetRotationOnMouseDown + (mouseX - mouseXOnMouseDown) * 0.002;
            }

            function onDocumentMouseUp(event) {
                renderer.domElement.addEventListener('mousemove', onDocumentMouseMove, false);
                renderer.domElement.addEventListener('mouseup', onDocumentMouseUp, false);
                renderer.domElement.addEventListener('mouseout', onDocumentMouseOut, false);

                resetButtonPositions();



            }

            function onDocumentMouseOut(event) {
                renderer.domElement.addEventListener('mousemove', onDocumentMouseMove, false);
                renderer.domElement.addEventListener('mouseup', onDocumentMouseUp, false);
                renderer.domElement.addEventListener('mouseout', onDocumentMouseOut, false);
            }

            function onDocumentTouchStart(event) {

            }

            function onDocumentTouchMove(event) {

            }

            function startButtonClick() {

                console.log("ENTERED STARTBUTTON CLICKED");
                actuatorCylinder.position.x += 1;



            }

            function resetButtonPositions() {

                actuatorCylinder.position.x =-7;


            }

            function render() {

                var time = Date.now() * 0.001;
                camera.lookAt(scene.position);
                group.rotation.y = time * 0.1;
                renderer.render(scene, camera);
                var newlightposition = camera.position;
                pointLight.position.set(camera.position.x, camera.position.y, camera.position.z);
            }

        </script>
    </body>
</html>
