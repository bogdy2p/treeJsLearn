<!DOCTYPE html>
<html lang="en">
    <head>
        <title>three.js webgl - InnoKin Sketch</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <style>
            body {
                color: #cccccc;
                font-family:Monospace;
                font-size:13px;
                text-align:center;

                background-color: #000000;
                margin: 0px;
                overflow: hidden;
            }

            #info {
                position: absolute;
                top: 0px; width: 100%;
                padding: 5px;
            }

            a {

                color: #0080ff;
            }

            #leftcontrols {
                position: absolute;
                bottom: 0px; width: 100%;
                height: 30px;
                padding: 5px;
                background-color: #FF66FF;
                /*z-index: 1000;*/
            }
        </style>
    </head>
    <body>

        <div id="container"></div>
        <div id="info">
            <a href="http://threejs.org" target="_blank">three.js</a> webgl - Innoking sketch  - by <a href="https://twitter.com/fernandojsg">ThePBC</a>
        </div>
        <div id ="leftcontrols">

            <button id="btn1" onclick="removeBattery();">Button1-RemoveBattery</button>

            <button id="btn2" onclick="">Button2-NOTHING YET</button>
            aAAAAAAAAAAAAAAAAAAAAAA</div>
        <div id ="rightcontrols"></div>


        <!--<script src="js/libs/dat.gui.min.js"></script>-->
        <script src="js/three.min.js"></script>
        <script type="text/javascript" src="js/RequestAnimationFrame.js"></script>
        <script src="js/OrbitControls.js"></script>
        <script src="js/libs/stats.min.js"></script>
        <script src="js/Tween.js"></script>
        <script src="dat-gui/build/DAT.GUI.js"></script>

        <script>

                var group;
                var container, stats;
                var leftControls, rightControls;
                var particlesData = [];
                var camera, scene, renderer, raycaster, camera2;
                var positions, colors;
                var pointCloud;
                var particlePositions;
                var linesMesh;
                var mouseX = 0, mouseY = 0;
                var mouseXOnMouseDown = 0;
                var SCREEN_WIDTH, SCREEN_HEIGHT;
                var targetRotation = 0;
                var actuatorCylinder, minusButtonCylinder, plusButtonCylinder, filtruTigara, chargerCube, disrupterCube;
                var targetRotationOnMouseDown = 0;
                var windowHalfX = window.innerWidth / 2;
                var windowHalfY = window.innerHeight / 2;
                var pointLight;
                var maxParticleCount = 1000;
                var particleCount = 500;
                var r = 800;
                var rHalf = r / 2;


                var ctrBtn1, ctrBtn2, ctrBtn3;

                var duration1 = 1000; //miliseconds
                var duration2 = 2000; //miliseconds
                var duration3 = 3000; //miliseconds
                var duration4 = 4000; //miliseconds
                var duration5 = 5000; //miliseconds
                var currentTime;
                var timeSpent = 0;
                var tweenBatteryOut, tweenBatteryIn, tweenBatteryUp, tweenBatteryDown;
                var startTime = Date.now();


                var userOpts = {
                    liftoff: 20,
                    range: 2000,
                    duration: 1500,
                    delay: 0,
                    easing: 'Exponential.EaseIn',
                    quintic_in: 'Quintic.EaseOut',
                }


                document.addEventListener('mousemove', onDocumentMouseMove, false);
                init();
                animate();

                function setupTweenBatteryOut()
                {
                    // 
                    var update = function () {
                        chargerCube.position.y = current.y;
                        chargerCube.position.x = current.x;
                    }
                    var current = {x: 15, y: 0};

                    // remove previous tweens if needed
                    TWEEN.removeAll();

                    // convert the string from dat-gui into tween.js functions 
                    var easing2 = TWEEN.Easing[userOpts.easing.split('.')[0]][userOpts.easing.split('.')[1]];
                    console.log(easing2);
//                    console.log(easing);
//                    
//                    
//                    
                    // build the tween lift the battery from the support

                    tweenBatteryUp = new TWEEN.Tween(current)
                            .to({y: +userOpts.liftoff}, userOpts.duration / 2)
                            .delay(userOpts.delay)
                            .easing(easing2)
                            .onUpdate(update);



                    tweenBatteryOut = new TWEEN.Tween(current)
                            .to({x: +userOpts.range}, userOpts.duration)
                            .delay(userOpts.delay)
                            .easing(easing2)
                            .onUpdate(update);
                    
                    tweenBatteryUp.chain(tweenBatteryOut);
                  
                    // start the first
//                    tweenHead.start();
                }

                function setupTweenBatteryIn()
                {
                    // 
                    var complete = function (){
                        console.log("BATTERY ATTACHED. PLAYING A CLICK SOUND !");
                        setTimeout(function(){
                            alert("PLAYING CLICK SOUND NOW");
                        },300);
                        
                    }
                    
                    var update = function () {
                        chargerCube.position.x = current.x;
                        chargerCube.position.y = current.y;
                    }
                    var current = {x: 2000, y: userOpts.liftoff};

                    // remove previous tweens if needed
                    TWEEN.removeAll();

                    // convert the string from dat-gui into tween.js functions 
                    var easing = TWEEN.Easing[userOpts.easing.split('.')[0]][userOpts.easing.split('.')[1]];
                    
                    var quintic = TWEEN.Easing[userOpts.quintic_in.split('.')[0]][userOpts.quintic_in.split('.')[1]];
//                    console.log(easing);
                    // build the tween to go ahead
                    tweenBatteryIn = new TWEEN.Tween(current)
                            .to({x: 15, y: userOpts.liftoff}, userOpts.duration)
                            .delay(userOpts.delay)
                            .easing(quintic)
                            .onUpdate(update);
                    // build the tween to go backward
                    tweenBatteryDown = new TWEEN.Tween(current)
                            .to({x: 15, y: 0}, userOpts.duration / 2)
                            .delay(userOpts.delay)
                            .easing(easing)
                            .onUpdate(update)
                            .onComplete(complete);
//                    var tweenBack = new TWEEN.Tween(current)
//                            .to({x: -userOpts.range}, userOpts.duration)
//                            .delay(userOpts.delay)
//                            .easing(easing)
//                            .onUpdate(update);
                    tweenBatteryIn.chain(tweenBatteryDown);
                    // after tweenHead do tweenBack
//                    tweenHead.chain(tweenBack);
                    // after tweenBack do tweenHead, so it is cycling
//                    tweenBack.chain(tweenHead);

                    // start the first
//                    tweenHead.start();
                }

                function setupTweenFilterRotate()
                {
                    // 
                    var update = function () {
                        filtruTigara.rotation.y = current.rotY;
                        filtruTigara.position.x = current.x;
                        filtruTigara.position.y = current.y;
                    }
                    var current = {x: 2000, y: userOpts.liftoff, rotY:0};

                    // remove previous tweens if needed
                    TWEEN.removeAll();

                    // convert the string from dat-gui into tween.js functions 
                    var easing = TWEEN.Easing[userOpts.easing.split('.')[0]][userOpts.easing.split('.')[1]];
                    
                    var quintic = TWEEN.Easing[userOpts.quintic_in.split('.')[0]][userOpts.quintic_in.split('.')[1]];
//                    console.log(easing);
                    // build the tween to go ahead
//                    tweenFilterRotate = new TWEEN.Tween(current)
//                            .to({x: 15, y: userOpts.liftoff}, userOpts.duration)
//                            .delay(userOpts.delay)
//                            .easing(quintic)
//                            .onUpdate(update);
                    // build the tween to go backward
//                    tweenBatteryDown = new TWEEN.Tween(current)
//                            .to({x: 15, y: 0}, userOpts.duration / 2)
//                            .delay(userOpts.delay)
//                            .easing(easing)
//                            .onUpdate(update);
//                    var tweenBack = new TWEEN.Tween(current)
//                            .to({x: -userOpts.range}, userOpts.duration)
//                            .delay(userOpts.delay)
//                            .easing(easing)
//                            .onUpdate(update);
//                    tweenBatteryIn.chain(tweenBatteryDown);
                    // after tweenHead do tweenBack
//                    tweenHead.chain(tweenBack);
                    // after tweenBack do tweenHead, so it is cycling
//                    tweenBack.chain(tweenHead);

                    // start the first
//                    tweenHead.start();
                }

                function setupTweenFilterGoUp()
                {
                    // 
                    var update = function () {
                        chargerCube.position.x = current.x;
                        chargerCube.position.y = current.y;
                    }
                    var current = {x: 2000, y: userOpts.liftoff};

                    // remove previous tweens if needed
                    TWEEN.removeAll();

                    // convert the string from dat-gui into tween.js functions 
                    var easing = TWEEN.Easing[userOpts.easing.split('.')[0]][userOpts.easing.split('.')[1]];
                    
                    var quintic = TWEEN.Easing[userOpts.quintic_in.split('.')[0]][userOpts.quintic_in.split('.')[1]];
//                    console.log(easing);
                    // build the tween to go ahead
                    tweenBatteryIn = new TWEEN.Tween(current)
                            .to({x: 15, y: userOpts.liftoff}, userOpts.duration)
                            .delay(userOpts.delay)
                            .easing(quintic)
                            .onUpdate(update);
                    // build the tween to go backward
                    tweenBatteryDown = new TWEEN.Tween(current)
                            .to({x: 15, y: 0}, userOpts.duration / 2)
                            .delay(userOpts.delay)
                            .easing(easing)
                            .onUpdate(update);
//                    var tweenBack = new TWEEN.Tween(current)
//                            .to({x: -userOpts.range}, userOpts.duration)
//                            .delay(userOpts.delay)
//                            .easing(easing)
//                            .onUpdate(update);
                    tweenBatteryIn.chain(tweenBatteryDown);
                    // after tweenHead do tweenBack
//                    tweenHead.chain(tweenBack);
                    // after tweenBack do tweenHead, so it is cycling
//                    tweenBack.chain(tweenHead);

                    // start the first
//                    tweenHead.start();
                }

                function setupTweenFilterGoOut()
                {
                    // 
                    var update = function () {
                        chargerCube.position.x = current.x;
                        chargerCube.position.y = current.y;
                    }
                    var current = {x: 2000, y: userOpts.liftoff};

                    // remove previous tweens if needed
                    TWEEN.removeAll();

                    // convert the string from dat-gui into tween.js functions 
                    var easing = TWEEN.Easing[userOpts.easing.split('.')[0]][userOpts.easing.split('.')[1]];
                    
                    var quintic = TWEEN.Easing[userOpts.quintic_in.split('.')[0]][userOpts.quintic_in.split('.')[1]];
//                    console.log(easing);
                    // build the tween to go ahead
                    tweenBatteryIn = new TWEEN.Tween(current)
                            .to({x: 15, y: userOpts.liftoff}, userOpts.duration)
                            .delay(userOpts.delay)
                            .easing(quintic)
                            .onUpdate(update);
                    // build the tween to go backward
                    tweenBatteryDown = new TWEEN.Tween(current)
                            .to({x: 15, y: 0}, userOpts.duration / 2)
                            .delay(userOpts.delay)
                            .easing(easing)
                            .onUpdate(update);
//                    var tweenBack = new TWEEN.Tween(current)
//                            .to({x: -userOpts.range}, userOpts.duration)
//                            .delay(userOpts.delay)
//                            .easing(easing)
//                            .onUpdate(update);
                    tweenBatteryIn.chain(tweenBatteryDown);
                    // after tweenHead do tweenBack
//                    tweenHead.chain(tweenBack);
                    // after tweenBack do tweenHead, so it is cycling
//                    tweenBack.chain(tweenHead);

                    // start the first
//                    tweenHead.start();
                }

                function init() {

                    container = document.getElementById('container');

                    SCREEN_WIDTH = window.innerWidth;
                    SCREEN_HEIGHT = window.innerHeight;
                    camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 1000);
                    camera.position.x = -70;
                    camera.position.z = 90;
                    camera.position.y = 70;
                    raycaster = new THREE.Raycaster();
                    // LIGHTS

                    controls = new THREE.OrbitControls(camera, container);
                    controls.noZoom = false;
                    controls.minDistance = 60;
                    controls.maxDistance = 200;
                    controls.noPan = true;
                    scene = new THREE.Scene();


                    var ambientLight = new THREE.AmbientLight(0x222222, 0.2);
//                  scene.add(ambientLight);

                    var dirLight = new THREE.DirectionalLight(0xffffff, 0.125);
                    dirLight.position.set(0, 0, 1).normalize();
//                  scene.add(dirLight);

                    pointLight = new THREE.PointLight(0xffffff, 1);
                    pointLight.position.set(0, 100, 90);
                    scene.add(pointLight);
                    group = new THREE.Group();
                    scene.add(group);
                    ///////ADD FILTRU

                    var loader = new THREE.JSONLoader(); //initialize the loader util.

                    var asd = loader.load('FiltruTigara.json', function (geometry) {

                        var material2 = new THREE.MeshFaceMaterial([
                            new THREE.MeshPhongMaterial({color: 0x999999, shading: THREE.SmoothShading}), // front
                            new THREE.MeshPhongMaterial({color: 0xFF0000, shading: THREE.SmoothShading}) // side
                        ]);
                        //create a mesh with models geometry and material
                        filtruTigara = new THREE.Mesh(geometry, material2);
                        filtruTigara.rotation.x = 0;
                        filtruTigara.rotation.y = 0;
                        filtruTigara.scale.x = 1;
                        filtruTigara.scale.y = 1;
                        filtruTigara.scale.z = 1;
                        filtruTigara.position.x = 0;
                        filtruTigara.position.y = 24;
                        filtruTigara.position.z = 0;
                        scene.add(filtruTigara);
                    });
                    // Add Charger 
                    //Grosime,Lungime,Latime
                    var chargerGeometry = new THREE.BoxGeometry(15, 50, 10);
                    var chargerMaterial = new THREE.MeshPhongMaterial({color: 0x666677, shininess: 10, specular: 0x999999, metal: true, side: 2});
                    chargerCube = new THREE.Mesh(chargerGeometry, chargerMaterial);
                    chargerCube.position.x = 15;
                    scene.add(chargerCube);
                    var disrupterGeometry = new THREE.BoxGeometry(15, 50, 10);
                    var disrupterMaterial = new THREE.MeshPhongMaterial({color: 0x88ff00, shininess: 8, specular: 0x999999, metal: true, transparent: true, opacity: 0.5});
                    disrupterCube = new THREE.Mesh(disrupterGeometry, disrupterMaterial);
                    scene.add(disrupterCube);
                    //Big Action Button

                    var actuatorGeometry = new THREE.CylinderGeometry(3, 3, 2, 32);
                    var actuatorMaterial = new THREE.MeshPhongMaterial({color: 0x004433});
//                  console.log(actuatorMaterial);


                    actuatorCylinder = new THREE.Mesh(actuatorGeometry, actuatorMaterial);
                    actuatorCylinder.position.x = -7;
                    actuatorCylinder.position.y = 18;
                    actuatorCylinder.position.z = 0;
                    actuatorCylinder.rotation.x = -Math.PI / 2;
                    actuatorCylinder.rotation.z = -Math.PI / 2;
                    scene.add(actuatorCylinder);
                    ////////
                    ///Plus Button

                    var plusButtonGeometry = new THREE.CylinderGeometry(1, 1, 2, 32);
                    var plusButtonMaterial = new THREE.MeshBasicMaterial({color: 0x00ff00});
                    plusButtonCylinder = new THREE.Mesh(plusButtonGeometry, plusButtonMaterial);
                    plusButtonCylinder.position.x = -7;
                    plusButtonCylinder.position.y = 12;
                    plusButtonCylinder.position.z = 0;
                    plusButtonCylinder.rotation.x = -Math.PI / 2;
                    plusButtonCylinder.rotation.z = -Math.PI / 2;
                    scene.add(plusButtonCylinder);
                    ////////
                    ///Minus Button
                    var minusButtonGeometry = new THREE.CylinderGeometry(1, 1, 2, 32);
                    var minusButtonMaterial = new THREE.MeshBasicMaterial({color: 0x00ffff});
                    minusButtonCylinder = new THREE.Mesh(minusButtonGeometry, minusButtonMaterial);
                    minusButtonCylinder.position.x = -7;
                    minusButtonCylinder.position.y = 7;
                    minusButtonCylinder.position.z = 0;
                    minusButtonCylinder.rotation.x = -Math.PI / 2;
                    minusButtonCylinder.rotation.z = -Math.PI / 2;
                    scene.add(minusButtonCylinder);
                    var displayGeometry = new THREE.PlaneGeometry(8, 20, 32);
                    var displayMaterial = new THREE.MeshPhongMaterial({color: 0xff0000, side: THREE.DoubleSide});
                    var displayPlane = new THREE.Mesh(displayGeometry, displayMaterial);
                    displayPlane.position.x = -7.6;
                    displayPlane.position.y = -12;
                    displayPlane.position.z = 0;
                    displayPlane.rotation.y = -Math.PI / 2;
                    scene.add(displayPlane);

                    renderer = new THREE.WebGLRenderer({antialias: true});
                    renderer.setClearColor(0xffffff, 0.4);
                    renderer.setPixelRatio(window.devicePixelRatio);
                    renderer.setSize(window.innerWidth, window.innerHeight);
                    renderer.gammaInput = true;
                    renderer.gammaOutput = true;
                    container.appendChild(renderer.domElement);

                    stats = new Stats();
                    stats.domElement.style.position = 'absolute';
                    stats.domElement.style.top = '0px';
                    container.appendChild(stats.domElement);
                    renderer.domElement.addEventListener('mousedown', onDocumentMouseDown, false);
                    renderer.domElement.addEventListener('touchstart', onDocumentTouchStart, false);
                    renderer.domElement.addEventListener('touchmove', onDocumentTouchMove, false);
                    window.addEventListener('resize', onWindowResize, false);
                }

                function onWindowResize() {

                    windowHalfX = window.innerWidth / 2;
                    windowHalfY = window.innerHeight / 2;
                    camera.aspect = window.innerWidth / window.innerHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(window.innerWidth, window.innerHeight);
                }

                function animate() {
                    render();
                    requestAnimationFrame(animate);

                    stats.update();
                    TWEEN.update();
                    
                }

                function onDocumentMouseDown(event) {
                    event.preventDefault();
                    renderer.domElement.addEventListener('mousemove', onDocumentMouseMove, false);
                    renderer.domElement.addEventListener('mouseup', onDocumentMouseUp, false);
                    renderer.domElement.addEventListener('mouseout', onDocumentMouseOut, false);

                    var mouseVector = new THREE.Vector3();
                    mouseVector.x = 2 * (event.clientX / SCREEN_WIDTH) - 1;
                    mouseVector.y = 1 - 2 * (event.clientY / SCREEN_HEIGHT);

                    raycaster.setFromCamera(mouseVector, camera);

                    var intersectedObjects = raycaster.intersectObjects(scene.children);

                    if (intersectedObjects.length > 0) {

                        var Object = intersectedObjects[0];

                        switch (Object.object.id) {

                            case 8:
                                console.log("That's the battery mate!");
                                break;
                            case 9:
                                console.log("You clicked the disruptor");
                                break;
                            case 10:
                                console.log("Lighter should START");
                                startButtonClick();

                                break;
                            case 11:
                                console.log("You pressed the +");
                                plusButtonClick();

                                break;
                            case 12:
                                console.log("You pressed the -");
                                minusButtonClick();
                                break;
                            case 13:
                                console.log("Why did you click the screen ?");
                                break;
                            case 14:
                                console.log("Why click the Filter ?");
                                break;
                            default:
                                console.log("nothing clicked");
                                break;
                        }

                    }


                }



                function onDocumentMouseMove(event) {

                    mouseX = event.clientX - windowHalfX;
                    targetRotationX = targetRotationOnMouseDown + (mouseX - mouseXOnMouseDown) * 0.002;
                }

                function onDocumentMouseUp(event) {
                    renderer.domElement.addEventListener('mousemove', onDocumentMouseMove, false);
                    renderer.domElement.addEventListener('mouseup', onDocumentMouseUp, false);
                    renderer.domElement.addEventListener('mouseout', onDocumentMouseOut, false);
                    resetButtonPositions();


                }

                function onDocumentMouseOut(event) {
                    renderer.domElement.addEventListener('mousemove', onDocumentMouseMove, false);
                    renderer.domElement.addEventListener('mouseup', onDocumentMouseUp, false);
                    renderer.domElement.addEventListener('mouseout', onDocumentMouseOut, false);
                }

                function onDocumentTouchStart(event) {
//                    alert("TOUCH DETECTED");
//                    alert(event);
                }

                function onDocumentTouchMove(event) {
//                    alert("TOUCH MOVEMENT DETECTED");
                }

                function startButtonClick() {

                    console.log("ENTERED STARTBUTTON CLICKED");
                    actuatorCylinder.position.x += 1;
                }

                function plusButtonClick() {
                    console.log("plusbuttonclick function");
                    plusButtonCylinder.position.x += 1;
                }

                function minusButtonClick() {
                    console.log("Minusbutton click function");
                    minusButtonCylinder.position.x += 1;
                }

                function resetButtonPositions() {

                    actuatorCylinder.position.x = -7;
                    minusButtonCylinder.position.x = -7;
                    plusButtonCylinder.position.x = -7;

                }

                function render() {

                    var time = Date.now() * 0.001;
                    camera.lookAt(scene.position);
                    group.rotation.y = time * 0.1;


                    renderer.render(scene, camera);
                    var newlightposition = camera.position;
                    pointLight.position.set(camera.position.x, camera.position.y, camera.position.z);
                }


                function removeBattery() {
                    setupTweenBatteryOut();
                    setupTweenBatteryIn();
                    tweenBatteryUp.start();
                    setTimeout(function () {
                        var newChargerMaterial = new THREE.MeshPhongMaterial({color: 0x666677, shininess: 10, specular: 0x990000, metal: true, side: 2});
                        chargerCube.material = newChargerMaterial;
                    }, 2400);
                    setTimeout(function () {
                        tweenBatteryOut.stop();
                        tweenBatteryIn.start();
                    }, 3000);
                    setTimeout(function () {
                        tweenBatteryIn.stop();
                    }, 4700);
                    setTimeout(function() {
//                        alert("Click sound");
                    }, 5200);
                }

                function removeFilter(){
                    
                    setupTweenFilterRotate();
                    setupTweenFilterGoUp();
                    setupTweenFilterGoOut();                  
                    
                }

//                function animateRemove1() {
//                    if (timeSpent <= duration1) {
//                        requestAnimationFrame(animateRemove1);
//                        var now = Date.now();
//                        var deltat = now - currentTime;
//                        currentTime = now;
//                        var fract = deltat / duration1;
//                        var angle = Math.PI * 2 * fract;
//                        chargerCube.position.y += 0.5;
//                        timeSpent += deltat;
//                        render();
//                        stats.update();
//                    }
//
//                }





        </script>
    </body>
</html>
